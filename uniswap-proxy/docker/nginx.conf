server {
    listen 80;
    server_name localhost;

    # 欢迎页面
    location = /welcome {
        default_type text/html;
        return 200 '
        <!DOCTYPE html>
        <html>
          <head>
            <title>Nginx代理</title>
            <style>
              body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
              h1 { color: #ff007a; }
              .container { max-width: 800px; margin: 0 auto; }
              .button { 
                display: inline-block; 
                padding: 10px 20px; 
                background-color: #ff007a; 
                color: white; 
                text-decoration: none;
                border-radius: 20px;
                font-weight: bold;
              }
            </style>
          </head>
          <body>
            <div class="container">
              <h1>Nginx代理服务器</h1>
              <p>这个版本使用Nginx作为代理，提供更稳定的代理服务。</p>
              <a href="/swap" class="button">前往Uniswap交换页面</a>
              <p>如果有问题，请先测试代理服务器是否正常：<a href="/test">测试链接</a></p>
            </div>
          </body>
        </html>
        ';
    }

    # 测试路由
    location = /test {
        default_type text/plain;
        return 200 'Nginx代理服务器正常运行！';
    }

    # 代理规则
    location / {
        # 设置代理参数
        proxy_pass https://app.uniswap.org;
        proxy_set_header Host app.uniswap.org;
        proxy_set_header Origin https://app.uniswap.org;
        proxy_set_header Referer https://app.uniswap.org/;
        proxy_set_header User-Agent $http_user_agent;
        
        # 启用HTTP 1.1
        proxy_http_version 1.1;
        proxy_set_header Connection "";
        
        # 超时设置
        proxy_connect_timeout 300;
        proxy_send_timeout 300;
        proxy_read_timeout 300;
        
        # 缓冲设置
        proxy_buffer_size 128k;
        proxy_buffers 4 256k;
        proxy_busy_buffers_size 256k;
        
        # 处理HTML内容 - 在</head>前注入脚本
        sub_filter '</head>' '<script src="/inject.js"></script></head>';
        sub_filter_once on;
        sub_filter_types text/html;
    }
} 